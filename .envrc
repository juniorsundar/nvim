# shellcheck shell=bash
if ! has nix_direnv_version || ! nix_direnv_version 3.1.0; then
  source_url "https://raw.githubusercontent.com/nix-community/nix-direnv/3.1.0/direnvrc" "sha256-yMJ2OVMzrFaDPn7q8nCBZFRYpL/f0RcHzhmw/i6btJM="
fi
use flake

nvim --headless -c 'lua local lib = {}; for _, p in ipairs(vim.api.nvim_list_runtime_paths()) do lib[#lib+1] = p .. "/lua" end; table.insert(lib, "${3rd}/luv/library"); local f = io.open(".luarc.json", "w"); f:write(vim.fn.json_encode({runtime={version="LuaJIT"}, diagnostics={globals={"vim"}}, workspace={library=lib, checkThirdParty=false}})); f:close()' -c 'qa'